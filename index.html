<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 3D Star Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="title-bar">
        <h1>3D Star Map Explorer</h1>
    </div>

    <div id="canvasContainer" style="flex-grow: 1; position: relative;">
        <canvas id="renderCanvas"></canvas>
        <div id="loading-indicator">Processing Star Data...</div>
        <div id="search-not-found">Star not found</div>
    </div>

    <div class="overlay-panel">
        <h2 class="panel-header">Search & View</h2>
        <div class="relative mb-1">
            <input type="text" id="search-input" class="search-input w-full pr-8" placeholder="Star Name..." autocomplete="off">
            <button id="clear-search-button" class="absolute right-2 top-1/2 -translate-y-1/2 text-white" title="Clear search">X</button>
            <div id="autocomplete-suggestions" class="hidden"></div>
        </div>
        <div class="relative mb-3">
            <select id="constellation-select" class="constellation-select w-full pr-8">
                <option value="">Select Constellation...</option>
            </select>
        </div>
        <h2 class="panel-header">Filters</h2>
        <div class="mb-2">
            <label class="flex items-center space-x-2">
                <input type="checkbox" id="proper-name-filter" class="filter-checkbox">
                <span>Show Only Named Stars</span>
            </label>
        </div>
        <div class="mb-3 p-2 border border-cyan-800 rounded-md">
            <h3 class="text-sm font-semibold mb-2">Spectral Legend</h3>
            <div id="spectral-legend" class="space-y-1 text-xs"></div>
        </div>
        <div class="mb-2">
            <label class="flex items-center space-x-2">
                <input type="checkbox" id="garbage-sphere-filter" class="filter-checkbox">
                <span>Toggle Garbage Sphere</span>
            </label>
        </div>
        <div class="mb-3 p-2 border border-cyan-800 rounded-md">
            <label for="distance-slider" class="block mb-1 text-sm font-semibold">Distance Filter (pc): <span id="distance-value" class="font-normal"></span></label>
            <input type="range" id="distance-slider" class="w-full">
        </div>
        <div class="mb-3 p-2 border border-cyan-800 rounded-md">
            <label for="size-slider" class="block mb-1 text-sm font-semibold">Star Size Filter (Relative): <span id="size-value" class="font-normal"></span></label>
            <input type="range" id="size-slider" class="w-full">
        </div>
        <div class="filter-grid">
            <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox" value="O"><span>O</span></label>
            <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox" value="B"><span>B</span></label>
            <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox" value="A"><span>A</span></label>
            <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox" value="F"><span>F</span></label>
            <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox" value="G"><span>G</span></label>
            <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox" value="K"><span>K</span></label>
            <label class="flex items-center space-x-2"><input type="checkbox" class="filter-checkbox" value="M"><span>M</span></label>
        </div>
        <hr class="my-3 border-cyan-700">
        <h2 class="panel-header">Selection Info</h2>
        <div id="selection-info" class="space-y-1 text-sm">
            <p><span class="info-label">Name:</span><span id="star-name" class="info-value">N/A</span></p>
            <p><span class="info-label">Distance:</span><span id="star-dist" class="info-value">N/A</span></p>
            <p><span class="info-label">Magnitude:</span><span id="star-mag" class="info-value">N/A</span></p>
            <p><span class="info-label">Class:</span><span id="star-spect" class="info-value">N/A</span></p>
            <p><span class="info-label">Coords:</span><span id="star-coords" class="info-value">N/A</span></p>
            <div id="route-buttons-container" class="flex gap-2 mt-2 hidden">
                <button id="set-start-button" class="custom-button text-xs px-2 py-1 flex-grow">Set as Start</button>
                <button id="set-end-button" class="custom-button text-xs px-2 py-1 flex-grow">Set as End</button>
            </div>
        </div>
        <div id="star-description-container" class="mt-3 hidden">
            <div class="flex justify-between items-center mb-1">
                <h3 class="text-md font-semibold text-cyan-400">Details</h3>
                <button id="narrate-button" class="custom-button text-xs px-2 py-1">â–¶ Narrate</button>
            </div>
            <p id="star-description" class="text-xs text-cyan-100 bg-black bg-opacity-20 p-2 rounded-md h-24 overflow-y-auto"></p>
        </div>
        <div id="route-planner-container" class="mt-3 hidden">
            <hr class="my-3 border-cyan-700">
            <h2 class="panel-header">Route Planner</h2>
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm font-semibold">Active Route: <span id="active-route-display">1</span></span>
                <div id="route-selector-buttons" class="flex gap-1">
                    <!-- Buttons will be generated by script.js -->
                </div>
            </div>
            <div class="text-sm space-y-2">
                <p><span class="info-label">Start:</span><span id="route-start-star" class="info-value">None</span></p>
                <p><span class="info-label">End:</span><span id="route-end-star" class="info-value">None</span></p>
                <label for="max-jump-range" class="block mb-1 text-sm font-semibold">Max Jump (pc):</label>
                <input type="number" id="max-jump-range" class="search-input w-full" value="50">
                <div class="flex gap-2 mt-2">
                    <button id="calculate-route-button" class="custom-button flex-grow">Calculate Route</button>
                    <button id="find-min-jump-button" class="custom-button flex-grow">Find Min. Jump</button>
                </div>
                <div id="route-navigation-container" class="flex gap-2 mt-2 hidden">
                    <button id="jump-to-start-button" class="custom-button text-xs px-2 py-1 flex-grow">Go to Start</button>
                    <button id="next-jump-button" class="custom-button text-xs px-2 py-1 flex-grow">Next Jump</button>
                    <button id="jump-to-end-button" class="custom-button text-xs px-2 py-1 flex-grow">Go to End</button>
                    <button id="follow-route-button" class="custom-button text-xs px-2 py-1 flex-grow">Follow Route</button>
                </div>
                <p id="route-progress-display" class="text-center text-cyan-400 text-sm mt-2 hidden"></p>
                <p id="route-calculating-message" class="text-center text-cyan-400 mt-2 hidden">Calculating...</p>
            </div>
        </div>
        <!-- Main Controls -->
        <div class="control-group mb-3">
            <h2 class="panel-header">Navigation</h2>
            <div class="grid grid-cols-2 gap-2">
                <button id="resetViewButton" class="custom-button">Reset View</button>
                <button id="snapToSolButton" class="custom-button">Snap to Sol</button>
            </div>
        </div>
        <div class="control-group mb-3">
            <h2 class="panel-header">Visual FX</h2>
            <div class="space-y-2">
                <label class="flex items-center space-x-2">
                    <input type="checkbox" id="bloom-toggle" class="filter-checkbox" checked>
                    <span>Enable Bloom</span>
                </label>
                <div class="p-2 border border-cyan-800 rounded-md">
                    <label for="bloom-strength" class="block mb-1 text-sm font-semibold">Bloom Strength: <span id="bloom-strength-value" class="font-normal">0.6</span></label>
                    <input type="range" id="bloom-strength" min="0" max="2" step="0.05" value="0.6" class="w-full">
                </div>
                <div class="p-2 border border-cyan-800 rounded-md">
                    <label for="visual-preset" class="block mb-1 text-sm font-semibold">Visual Preset</label>
                    <select id="visual-preset" class="constellation-select w-full">
                        <option value="scientific">Scientific</option>
                        <option value="cinematic" selected>Cinematic</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="control-group mb-3">
            <h2 class="panel-header">Modes</h2>
            <div class="grid grid-cols-3 gap-2">
                <button id="toggle-fly-mode-button" class="custom-button">Fly</button>
                <button id="stellar-tour-button" class="custom-button">Tour</button>
                <button id="toggle-route-planner-button" class="custom-button">Plan Route</button>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <div id="star-count-display" class="text-cyan-300 text-sm font-semibold"></div>
    </div>    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "./vendor/three/build/three.module.js",
                "three/addons/": "./vendor/three/examples/jsm/"
            }
        }
    </script>
    <script src="star_details.js" defer></script>
    <script src="constellations.js" defer></script>
    <script type="module" src="script.js"></script>
</body>
</html>